## Exercise
Create a function that takes a dictionary of student names and their corresponding grades as input. The function should then calculate the average grade of all students and return a dictionary with the student names as keys and their respective grades along with a message indicating whether they are above or below the average grade.

## Reference Solution
```python
def calculate_average_grade(grades):
    """
    This function calculates the average grade of all students and returns a dictionary 
    with the student names as keys, their respective grades, and a message indicating 
    whether they are above or below the average grade.

    Args:
        grades (dict): A dictionary where keys are student names and values are their grades.

    Returns:
        dict: A dictionary where keys are student names, values are dictionaries containing 
        the student's grade and a message indicating whether they are above or below the average grade.
    """

    # First, we need to calculate the sum of all grades to find the average later
    total_grade = sum(grades.values())

    # Then, we calculate the average grade by dividing the total grade by the number of students
    average_grade = total_grade / len(grades)

    # Initialize an empty dictionary to store the results
    result = {}

    # Iterate over each student in the grades dictionary
    for student, grade in grades.items():
        # For each student, check if their grade is above or below the average
        if grade > average_grade:
            # If the grade is above the average, append a message indicating this
            message = "above the average"
        elif grade < average_grade:
            # If the grade is below the average, append a message indicating this
            message = "below the average"
        else:
            # If the grade is equal to the average, append a message indicating this
            message = "equal to the average"

        # Store the student's grade and message in the result dictionary
        result[student] = {"grade": grade, "message": message}

    # Finally, return the result dictionary
    return result

# Example usage:
grades = {
    "Alice": 90,
    "Bob": 80,
    "Charlie": 95,
    "David": 85
}

print(calculate_average_grade(grades))
```

## Generated Output
```
{'Alice': {'grade': 90, 'message': 'above the average'}, 'Bob': {'grade': 80, 'message': 'below the average'}, 'Charlie': {'grade': 95, 'message': 'above the average'}, 'David': {'grade': 85, 'message': 'below the average'}}
```

generated by python 3.10.13

solution generated by RedHatAI/Llama-3.3-70B-Instruct-FP8-dynamic
